define(["./persistenceUtils","./impl/logger"],function(a,b){"use strict";function c(a,b){var c,d=a[0].data;return c=d&&1===d.length&&"single"===a[0].resourceType?d[0]:{items:d,count:d.length}}var d=function(c,d,e){return function(f){b.log("Offline Persistence Toolkit oracleRestJsonShredding: Shredding Response");var g=f.clone(),h=g.headers.get("X-ORACLE-DMS-ECID");return g.text().then(function(f){var g=[],i=[],j="collection";if(null!=f&&f.length>0)try{var k=JSON.parse(f);if(null!=k.items)g=k.items.map(function(a){if(d instanceof Array){var b=[];return d.forEach(function(c){b.push(a[c])}),b}return a[d]}),i=k.items;else{if(d instanceof Array){var l=[];d.forEach(function(a){l.push(k[a])}),g[0]=l}else g[0]=k[d];i[0]=k,j="single"}}catch(a){b.log("Offline Persistence Toolkit oracleRestJsonShredding: Error during shredding: "+a)}var m=a._mapData(g,i,e);return[{name:c,resourceIdentifier:h,keys:m.keys,data:m.data,resourceType:j}]})}},e=function(d){return function(e,f){if(b.log("Offline Persistence Toolkit oracleRestJsonShredding: Unshredding Response"),!e||1!==e.length)throw new Error({message:"shredded data is not in the correct format."});var g=a._unmapData(e[0].keys,e[0].data,d),h=c([{keys:g.keys,data:g.data,resourceType:e[0].resourceType}],f);return a.setResponsePayload(f,h).then(function(a){return a.headers.set("x-oracle-jscpt-cache-expiration-date",""),a})}};return{getShredder:d,getUnshredder:e}});