/**
 * @license
 * Copyright (c) 2014, 2019, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 * @ignore
 */
"use strict";define(["ojs/ojcore","jquery","knockout","ojs/ojset","ojs/ojmap","ojs/ojdataprovider","ojs/ojeventtarget"],function(t,e,i,s,n,r){class a{constructor(t,e){this.data=t,this.options=e,this.Item=class{constructor(t,e,i){this._parent=t,this.metadata=e,this.data=i,this[a._METADATA]=e,this[a._DATA]=i}},this.ItemMetadata=class{constructor(t,e){this._parent=t,this.key=e,this[a._KEY]=e}},this.FetchByKeysResults=class{constructor(t,e,i){this._parent=t,this.fetchParameters=e,this.results=i,this[a._FETCHPARAMETERS]=e,this[a._RESULTS]=i}},this.ContainsKeysResults=class{constructor(t,e,i){this._parent=t,this.containsParameters=e,this.results=i,this[a._CONTAINSPARAMETERS]=e,this[a._RESULTS]=i}},this.FetchByOffsetResults=class{constructor(t,e,i,s){this._parent=t,this.fetchParameters=e,this.results=i,this.done=s,this[a._FETCHPARAMETERS]=e,this[a._RESULTS]=i,this[a._DONE]=s}},this.FetchListParameters=class{constructor(t,e,i,s){this._parent=t,this.size=e,this.sortCriteria=i,this.attributes=s,this[a._SIZE]=e,this[a._SORTCRITERIA]=i,this[a._ATTRIBUTES]=s}},this.FetchListResult=class{constructor(t,e,i,s){this._parent=t,this.fetchParameters=e,this.data=i,this.metadata=s,this[a._FETCHPARAMETERS]=e,this[a._DATA]=i,this[a._METADATA]=s}},this.AsyncIterable=class{constructor(t,e){this._parent=t,this._asyncIterator=e,this[Symbol.asyncIterator]=function(){return this._asyncIterator}}},this.AsyncIterator=class{constructor(t,e,i,s){this._parent=t,this._nextFunc=e,this._params=i,this._offset=s,this._cachedOffset=s,this._cacheObj={},this._cacheObj[a._MUTATIONSEQUENCENUM]=t._mutationSequenceNum}next(){let t=this._nextFunc(this._params,this._cachedOffset,this._cacheObj);return this._cachedOffset=this._cachedOffset+t.value[a._DATA].length,Promise.resolve(t)}},this.AsyncIteratorYieldResult=class{constructor(t,e){this._parent=t,this.value=e,this[a._VALUE]=e,this[a._DONE]=!1}},this.AsyncIteratorReturnResult=class{constructor(t,e){this._parent=t,this.value=e,this[a._VALUE]=e,this[a._DONE]=!0}},this.DataProviderMutationEventDetail=class{constructor(t,e,i,s){this._parent=t,this.add=e,this.remove=i,this.update=s,this[a._ADD]=e,this[a._REMOVE]=i,this[a._UPDATE]=s}},this.DataProviderOperationEventDetail=class{constructor(t,e,i,s,n){this._parent=t,this.keys=e,this.metadata=i,this.data=s,this.indexes=n,this[a._KEYS]=e,this[a._METADATA]=i,this[a._DATA]=s,this[a._INDEXES]=n}},this.DataProviderAddOperationEventDetail=class{constructor(t,e,i,s,n,r,l){this._parent=t,this.keys=e,this.afterKeys=i,this.addBeforeKeys=s,this.metadata=n,this.data=r,this.indexes=l,this[a._KEYS]=e,this[a._AFTERKEYS]=i,this[a._ADDBEFOREKEYS]=s,this[a._METADATA]=n,this[a._DATA]=r,this[a._INDEXES]=l}},this._cachedIndexMap=[],this._sequenceNum=0,this._mutationSequenceNum=0,this._subscribeObservableArray(t),null!=e&&null!=e[a._KEYS]&&(this._keysSpecified=!0,this._keys=e[a._KEYS])}containsKeys(t){let e=this;return this.fetchByKeys(t).then(function(i){let n=new s;return t[a._KEYS].forEach(function(t){null!=i[a._RESULTS].get(t)&&n.add(t)}),Promise.resolve(new e.ContainsKeysResults(e,t,n))})}fetchByKeys(e){let i=this;this._generateKeysIfNeeded();let s,r=new n,l=this._getKeys(),u=null!=e?e[a._ATTRIBUTES]:null,o=0;if(e){let n=i._getRowData();return e[a._KEYS].forEach(function(e){for(s=null,o=0;o<l.length;o++)if(t.Object.compareValues(l[o],e)){s=o;break}if(null!=s&&s>=0){let t=n[s];if(u&&u.length>0){let e={};i._filterRowAttributes(u,t,e),t=e}r.set(e,new i.Item(i,new i.ItemMetadata(i,e),t))}}),Promise.resolve(new i.FetchByKeysResults(i,e,r))}return Promise.reject("Keys are a required parameter")}fetchByOffset(t){let e=this,i=null!=t?t[a._SIZE]:-1,s=null!=t?t[a._SORTCRITERIA]:null,n=null!=t&&t[a._OFFSET]>0?t[a._OFFSET]:0,r=null!=t?t[a._ATTRIBUTES]:null;this._generateKeysIfNeeded();let l=[],u=!0;if(t){let o=new this.FetchListParameters(this,i,s,r),h=this._fetchFrom(o,n),_=h[a._VALUE];u=h[a._DONE];let c=_[a._DATA],f=_[a._METADATA].map(function(t){return t[a._KEY]});return l=c.map(function(t,i){return new e.Item(e,new e.ItemMetadata(e,f[i]),t)}),Promise.resolve(new this.FetchByOffsetResults(this,t,l,u))}return Promise.reject("Offset is a required parameter")}fetchFirst(t){return new this.AsyncIterable(this,new this.AsyncIterator(this,this._fetchFrom.bind(this),t,0))}getCapability(t){return a.getCapability(t)}static getCapability(t){if("sort"==t)return{attributes:"multiple"};if("fetchByKeys"==t)return{implementation:"lookup"};if("fetchByOffset"==t)return{implementation:"randomAccess"};if("fetchCapability"==t){let t=new Set;return t.add("exclusion"),{attributeFilter:{expansion:{},ordering:{},defaultShape:{features:t}}}}return"filter"==t?{operators:["$co","$eq","$ew","$pr","$gt","$ge","$lt","$le","$ne","$regex","$sw"],attributeExpression:["*"],textFilter:{}}:null}getTotalSize(){return Promise.resolve(this._getRowData().length)}isEmpty(){return this._getRowData().length>0?"no":"yes"}createOptimizedKeySet(t){return new s(t)}createOptimizedKeyMap(t){if(t){let e=new n;return t.forEach(function(t,i){e.set(i,t)}),e}return new n}_getRowData(){return this[a._DATA]instanceof Array?this[a._DATA]:this[a._DATA]()}_getKeys(){return null==this._keys||this._keys instanceof Array?this._keys:this._keys()}_indexOfKey(e){let i,s=this._getKeys(),n=-1;for(i=0;i<s.length;i++)if(t.Object.compareValues(s[i],e)){n=i;break}return n}_subscribeObservableArray(e){if(!(e instanceof Array)){if(!this._isObservableArray(e))throw new Error("Invalid data type. ArrayDataProvider only supports Array or observableArray.");let i=this;e.subscribe(function(e){let n,r,a,l,u,o=[],h=[],_=[],c=[],f=[];i._mutationSequenceNum++;let E=!0,d=!0;e.forEach(function(t){"deleted"===t.status?E=!1:"added"===t.status&&(d=!1)});let A=[],T=[],p=null,m=null,R=null,y=i._generateKeysIfNeeded();if(!E&&!d){for(n=0;n<e.length;n++){l=e[n].index,u=e[n].status;let s=i._getId(e[n].value);for(r=0;r<e.length;r++)r!=n&&l===e[r].index&&u!==e[r].status&&A.indexOf(n)<0&&T.indexOf(n)<0&&(null==s||t.Object.compareValues(s,i._getId(e[r].value)))&&("deleted"===u?(T.push(n),A.push(r)):(T.push(r),A.push(n)))}for(n=0;n<e.length;n++)if(A.indexOf(n)>=0){let t=i._getKeys()[e[n].index];h.push(t),o.push(e[n].value),_.push(e[n].index)}if(h.length>0){c=h.map(function(t){return new i.ItemMetadata(i,t)});let t=new s;h.map(function(e){t.add(e)}),p=new i.DataProviderOperationEventDetail(i,t,c,o,_)}}if(o=[],h=[],_=[],!E){for(n=0;n<e.length;n++)"deleted"===e[n].status&&A.indexOf(n)<0&&T.indexOf(n)<0&&(h.push(i._getKeys()[e[n].index]),o.push(e[n].value),_.push(e[n].index));if(h.length>0&&h.map(function(t){let e=i._indexOfKey(t);i._keys.splice(e,1)}),h.length>0){c=h.map(function(t){return new i.ItemMetadata(i,t)});let t=new s;h.map(function(e){t.add(e)}),R=new i.DataProviderOperationEventDetail(i,t,c,o,_)}}if(o=[],h=[],_=[],!d){let t=null==i._getKeys()||!(i._getKeys().length>0);for(n=0;n<e.length;n++)"added"===e[n].status&&A.indexOf(n)<0&&T.indexOf(n)<0&&(null==(a=i._getId(e[n].value))&&(y||i._keysSpecified)&&(a=i._getKeys()[e[n].index]),null==a?(a=i._sequenceNum++,i._keys.splice(e[n].index,0,a)):(t||-1===i._indexOfKey(a))&&i._keys.splice(e[n].index,0,a),h.push(a),o.push(e[n].value),_.push(e[n].index));for(n=0;n<e.length;n++)if("added"===e[n].status&&A.indexOf(n)<0&&T.indexOf(n)<0){let t=i._getKeys()[e[n].index+1];t=null==t?null:t,f.push(t)}if(h.length>0){c=h.map(function(t){return new i.ItemMetadata(i,t)});let t=new s;h.map(function(e){t.add(e)});let e=new s;f.map(function(t){e.add(t)}),m=new i.DataProviderAddOperationEventDetail(i,t,e,f,c,o,_)}}i._fireMutationEvent(m,R,p)},null,"arrayChange"),e.subscribe(function(e){i._mutationEvent?i.dispatchEvent(i._mutationEvent):i._mutationRemoveEvent||i._mutationAddEvent||i._mutationUpdateEvent?(i._mutationRemoveEvent&&i.dispatchEvent(i._mutationRemoveEvent),i._mutationAddEvent&&i.dispatchEvent(i._mutationAddEvent),i._mutationUpdateEvent&&i.dispatchEvent(i._mutationUpdateEvent)):i.dispatchEvent(new t.DataProviderRefreshEvent),i._mutationEvent=null,i._mutationRemoveEvent=null,i._mutationAddEvent=null,i._mutationUpdateEvent=null},null,"change")}}_fireMutationEvent(e,i,s){let n=this,r=!1;if(["keys","indexes"].forEach(function(t){r||(r=n._hasSamePropValue(i,e,t)||n._hasSamePropValue(i,s,t)||n._hasSamePropValue(e,s,t))}),r){if(i){let e=new this.DataProviderMutationEventDetail(this,null,i,null);this._mutationRemoveEvent=new t.DataProviderMutationEvent(e)}if(e){let i=new this.DataProviderMutationEventDetail(this,e,null,null);this._mutationAddEvent=new t.DataProviderMutationEvent(i)}if(s){let e=new this.DataProviderMutationEventDetail(this,null,null,s);this._mutationUpdateEvent=new t.DataProviderMutationEvent(e)}}else{let n=new this.DataProviderMutationEventDetail(this,e,i,s);this._mutationEvent=new t.DataProviderMutationEvent(n)}}_hasSamePropValue(e,i,s){let n=!1;return e&&e[s]&&e[s].forEach(function(e){!n&&i&&i[s]&&i[s].forEach(function(i){!n&&t.Object.compareValues(e,i)&&(n=!0)})}),n}_isObservableArray(t){return i.isObservable(t)&&!(void 0===t.destroyAll)}_generateKeysIfNeeded(){if(null==this._keys){let t=null!=this.options?this.options[a._KEYATTRIBUTES]||this.options[a._IDATTRIBUTE]:null;this._keys=[];let e,i=this._getRowData(),s=0;for(s=0;s<i.length;s++)null!=(e=this._getId(i[s]))&&"@index"!=t||(e=this._sequenceNum++),this._keys[s]=e;return!0}return!1}_getId(t){let e,i=null!=this.options?this.options[a._KEYATTRIBUTES]||this.options[a._IDATTRIBUTE]:null;if(null!=i){if(Array.isArray(i)){let s;for(e=[],s=0;s<i.length;s++)e[s]=this._getVal(t,i[s])}else e="@value"==i?this._getAllVals(t):this._getVal(t,i);return e}return null}_getVal(t,e){return"function"==typeof t[e]?t[e]():t[e]}_getAllVals(t){let e=this;return Object.keys(t).map(function(i){return e._getVal(t,i)})}_fetchFrom(t,e,i){let s=this,n=null!=t?t[a._ATTRIBUTES]:null;this._generateKeysIfNeeded();let l=null!=t?t[a._SORTCRITERIA]:null,u=this._getCachedIndexMap(l,i),o=this._getRowData(),h=u.map(function(t){let e=o[t];if(n&&n.length>0){let t={};s._filterRowAttributes(n,e,t),e=t}return e}),_=u.map(function(t){return s._getKeys()[t]}),c=null!=t?t[a._SIZE]>0?t[a._SIZE]:t[a._SIZE]<0?s._getKeys().length:25:25,f=e+c<h.length,E=this._mergeSortCriteria(l);null!=E&&((t=t||{})[a._SORTCRITERIA]=E);let d=[],A=[];if(null!=t&&t[a._FILTERCRITERION]){let i=null;i=t[a._FILTERCRITERION].filter?t[a._FILTERCRITERION]:r.FilterFactory.getFilter({filterDef:t[a._FILTERCRITERION],filterOptions:this.options});let s=e;for(;d.length<c&&s<h.length;)i.filter(h[s])&&(d.push(h[s]),A.push(_[s])),s++;f=s<h.length}else d=h.slice(e,e+c),A=_.slice(e,e+c);let T=A.map(function(t){return new s.ItemMetadata(s,t)}),p=new this.FetchListResult(this,t,d,T);return f?new this.AsyncIteratorYieldResult(this,p):new this.AsyncIteratorReturnResult(this,p)}_getCachedIndexMap(t,e){if(e&&e.indexMap&&e[a._MUTATIONSEQUENCENUM]===this._mutationSequenceNum)return e.indexMap;let i=this._getRowData().map(function(t,e){return e}),s=this._sortData(i,t);return e&&(e.indexMap=s,e[a._MUTATIONSEQUENCENUM]=this._mutationSequenceNum),s}_sortData(t,e){let i=this._getRowData(),s=t.map(function(t){return{index:t,value:i[t]}});return null!=e&&s.sort(this._getSortComparator(e)),s.map(function(t){return t.index})}_getSortComparator(t){let e=this;return function(i,s){let n,r,l,u,o,h,_=null!=e.options?e.options[a._SORTCOMPARATORS]:null;for(n=0;n<t.length;n++)if(r=t[n][a._DIRECTION],l=t[n][a._ATTRIBUTE],u=null,null!=_&&(u=_[a._COMPARATORS].get(l)),o=e._getVal(i.value,l),h=e._getVal(s.value,l),null!=u){let t="descending"==r?-1:1,e=u(o,h)*t;if(0!=e)return e}else{let t=0,e="string"==typeof o?o:new String(o).toString(),i="string"==typeof h?h:new String(h).toString();if(0!=(t="ascending"==r?e.localeCompare(i,void 0,{numeric:!0,sensitivity:"base"}):i.localeCompare(e,void 0,{numeric:!0,sensitivity:"base"})))return t}return 0}}_mergeSortCriteria(t){let e=null!=this.options?this.options[a._IMPLICITSORT]:null;if(null!=e){if(null==t)return e;let i,s,n,r=t.slice(0);for(i=0;i<e.length;i++){for(n=!1,s=0;s<r.length;s++)r[s][a._ATTRIBUTE]==e[i][a._ATTRIBUTE]&&(n=!0);n||r.push(e[i])}return r}return t}_filterRowAttributes(t,e,i){let s=this;if(Array.isArray(t)){let n,r=!1;t.forEach(function(t){t!=a._ATDEFAULT&&t.name!=a._ATDEFAULT||(r=!0)}),Object.keys(e).forEach(function(a){if(r){let r,l=!1,u=a;for(n=0;n<t.length;n++)if((r=t[n]instanceof Object?t[n].name:t[n]).startsWith("!")){if((r=r.substr(1,r.length-1))==a){l=!0;break}}else if(r==a){u=t[n];break}l||s._filterRowAttributes(u,e,i)}else t.forEach(function(t){let n;(n=t instanceof Object?t.name:t).startsWith("!")||n!=a||s._filterRowAttributes(t,e,i)})})}else if(t instanceof Object){let n=t.name,r=t.attributes;if(n&&!n.startsWith("!"))if(e[n]instanceof Object&&!Array.isArray(e[n])&&r){let t={};s._filterRowAttributes(r,e[n],t),i[n]=t}else if(Array.isArray(e[n])&&r){let t;i[n]=[],e[n].forEach(function(e,a){t={},s._filterRowAttributes(r,e,t),i[n][a]=t})}else s._proxyAttribute(i,e,n)}else s._proxyAttribute(i,e,t)}_proxyAttribute(t,e,i){t&&e&&Object.defineProperty(t,i,{get:function(){return e[i]},set:function(t){e[i]=t},enumerable:!0})}}
/**
 * @preserve Copyright 2013 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
/**
 * @preserve Copyright 2013 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
return a._KEY="key",a._KEYS="keys",a._AFTERKEYS="afterKeys",a._ADDBEFOREKEYS="addBeforeKeys",a._DIRECTION="direction",a._ATTRIBUTE="attribute",a._ATTRIBUTES="attributes",a._SORT="sort",a._SORTCRITERIA="sortCriteria",a._FILTERCRITERION="filterCriterion",a._DATA="data",a._METADATA="metadata",a._INDEXES="indexes",a._OFFSET="offset",a._SIZE="size",a._IDATTRIBUTE="idAttribute",a._IMPLICITSORT="implicitSort",a._KEYATTRIBUTES="keyAttributes",a._SORTCOMPARATORS="sortComparators",a._COMPARATORS="comparators",a._COMPARATOR="comparator",a._RESULTS="results",a._CONTAINS="contains",a._FETCHPARAMETERS="fetchParameters",a._CONTAINSPARAMETERS="containsParameters",a._VALUE="value",a._DONE="done",a._ADD="add",a._REMOVE="remove",a._UPDATE="update",a._DETAIL="detail",a._FETCHLISTRESULT="fetchListResult",a._ATDEFAULT="@default",a._MUTATIONSEQUENCENUM="mutationSequenceNum",t.ArrayDataProvider=a,t.EventTargetMixin.applyMixin(a),a});